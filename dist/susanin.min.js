!function(t){function e(t){return{"./querystring":function(){var t={},e=Object.prototype.hasOwnProperty,r=Object.prototype.toString,n=function(t){return"[object Array]"===r.call(t)},o={decode:function(t){var e;try{e=decodeURIComponent(t.replace(/\+/g,"%20"))}catch(r){e=t}return e},parse:function(t,r,a){var i,s,u,p,f,l,c,h={};if("string"!=typeof t||""===t)return h;for(r||(r="&"),a||(a="="),i=t.split(r),p=0,f=i.length;f>p;++p)l=o.decode(i[p]),c=l.indexOf(a),c>=0?(u=l.substr(0,c),s=l.substr(c+1)):(u=l,s=""),e.call(h,u)?n(h[u])?h[u].push(s):h[u]=[h[u],s]:h[u]=s;return h},stringify:function(t,r,n){var o,a,i,s,u,p,f="";if(!t)return f;r||(r="&"),n||(n="=");for(p in t)if(e.call(t,p))for(i=[].concat(t[p]),s=0,u=i.length;u>s;++s)a=typeof i[s],o="object"===a||"undefined"===a?"":encodeURIComponent(i[s]),f+=r+encodeURIComponent(p)+n+o;return f.substr(r.length)}};return t.exports=o,t.exports},"./route":function(){function t(e){if(!(this instanceof t))return new t(e);if("string"==typeof e&&(e={pattern:e}),i(e)&&(e={patterns:e}),i(e.patterns)||(e.patterns=[]),e.pattern&&(e.patterns.push(e.pattern),delete e.pattern),!e||"object"!=typeof e)throw new Error("You must specify options");this._options=e,this._conditions=e.conditions&&"object"==typeof e.conditions?e.conditions:{},this._conditions=this._setConditions(this._conditions),this._subRoutes=[];for(var r=0,n=e.patterns.length;n>r;r++){var o=e.patterns[r],a={},s="object"==typeof o?o.pattern:o;if("string"!=typeof s)throw new Error("You must specify the pattern of the route");e.isTrailingSlashOptional!==!1&&(s+=c+f+_+l+h),s+=c+"?"+f+b+l+h,a.pattern=s,a.paramsMap=[],a.mainParamsMap={},a.requiredParams=[],a.optionalParams=[],a.conditions=o.conditions?this._setConditions(o.conditions):this._conditions,a.defaults=o.defaults||this._options.defaults,a.parts=this._parsePattern(a,s),this._buildParseRegExp(a),this._buildBuildFn(a),this._subRoutes.push(a)}}var r={},n=Object.prototype.hasOwnProperty,o=function(t,e){return n.call(t,e)},a=Object.prototype.toString,i=function(t){return"[object Array]"===a.call(t)},s=e("./querystring"),u=function(){var t=["/",".","*","+","?","|","(",")","[","]","{","}","\\"],e=new RegExp("(\\"+t.join("|\\")+")","g");return function(t){return t.replace(e,"\\$1")}}(),p=String(Math.random()).substr(2,5),f="<",l=">",c="(",h=")",d="[a-zA-Z_][\\w\\-]*",m="[\\w\\-\\.~]+",g=new RegExp("("+u(f)+d+u(l)+"|"+"[^"+u(f)+u(l)+"]+"+"|"+u(f)+"|"+u(l)+")","g"),_="ts_"+p,y="/",P=u("/"),b="qs_"+p;return t.prototype._getDefaults=function(t){return t.defaults},t.prototype._setConditions=function(t){return this._options.isTrailingSlashOptional!==!1&&(t[_]=P),t[b]=".*",t},t.prototype._parsePattern=function(t,e,r){for(var n,o,a,i,s=[],u="",p=0,f=0,l=!1,d=e.length;d>p;)if(n=e.charAt(p++),n===c)l?(++f,u+=n):(this._parseParams(t,u,s,r),u="",f=0,l=!0);else if(n===h)if(l)if(0===f){for(u={what:"optional",dependOnParams:[],parts:this._parsePattern(t,u,!0)},s.push(u),o=0,a=u.parts.length;a>o;++o)i=u.parts[o]&&u.parts[o].what,"param"===i?u.dependOnParams.push(u.parts[o].name):"optional"===i&&u.dependOnParams.push.apply(u.dependOnParams,u.parts[o].dependOnParams);u="",l=!1}else--f,u+=n;else u+=n;else u+=n;return this._parseParams(t,u,s,r),s},t.prototype._parseParams=function(t,e,r,n){var o,a,i,s,u=e.match(g);if(u)for(o=0,a=u.length;a>o;++o)i=u[o],i.charAt(0)===f&&i.charAt(i.length-1)===l?(s=i.substr(1,i.length-2),t.paramsMap.push(s),t.mainParamsMap[s]=!0,n?t.optionalParams.push(s):t.requiredParams.push(s),r.push({what:"param",name:s})):r.push(i)},t.prototype._buildParseRegExp=function(t){t.parseRegExpSource="^"+this._buildParseRegExpParts(t,t.parts)+"$",t.parseRegExp=new RegExp(t.parseRegExpSource)},t.prototype._buildParseRegExpParts=function(t,e){var r,n,o,a="";for(r=0,n=e.length;n>r;++r)o=e[r],a+="string"==typeof o?u(o):"param"===o.what?"("+(this._getParamValueRegExpSource(t,o.name)||m)+")":"(?:"+this._buildParseRegExpParts(t,o.parts)+")?";return a},t.prototype._getParamValueRegExpSource=function(t,e){var r,n,a,s=t.conditions;return n=t.conditionRegExpSources||(t.conditionRegExpSources={}),o(n,e)||(o(s,e)?(a=s[e],r=i(a)?"(?:"+a.join("|")+")":a+""):r=null,n[e]=r),n[e]},t.prototype._getParamValueRegExp=function(t,e){var r,n;return n=t.conditions?t.conditionRegExps||(t.conditionRegExps={}):this._conditionRegExps||(this._conditionRegExps={}),o(n,e)||(r=this._getParamValueRegExpSource(t,e),n[e]=r?new RegExp("^"+r+"$"):null),n[e]},t.prototype._checkParamValue=function(t,e,r){var n=this._getParamValueRegExp(t,e);return n?n.test(r):!0},t.prototype._buildBuildFn=function(t){t._buildFnSource="var h=({}).hasOwnProperty;return "+this._buildBuildFnParts(t)+";",t._buildFn=new Function("p",t._buildFnSource)},t.prototype._buildBuildFnParts=function(t,e){var r,n,a,i,s,p,f='""',l=this._getDefaults(t);for(e||(e=t.parts),r=0,n=e.length;n>r;++r)if(s=e[r],"string"==typeof s)f+='+"'+u(s)+'"';else if("param"===s.what)t.mainParamsMap[s.name]=!0,f+='+(h.call(p,"'+u(s.name)+'")?'+'p["'+u(s.name)+'"]:'+(l&&o(l,s.name)?'"'+u(l[s.name])+'"':'""')+")";else{for(f+="+((false",a=0,i=s.dependOnParams.length;i>a;++a)p=s.dependOnParams[a],f+='||(h.call(p,"'+u(p)+'")'+(l&&o(l,p)?'&&p["'+u(p)+'"]!=="'+u(l[p])+'"':"")+")";f+=")?("+this._buildBuildFnParts(t,s.parts)+'):"")'}return f},t.prototype._isDataMatched=function(t){var e,r=this._options.data;if("function"==typeof t)return Boolean(t(r));if(t&&"object"==typeof t)for(e in t)if(o(t,e)&&(!r||"object"!=typeof r||r[e]!==t[e]))return!1;return!0},t.prototype._getPatternParamsIntersection=function(t,e,r){var n,a,i,s=[];for(r||(r={}),n=0,a=t.length;a>n;n++)i=t[n],(o(e,i)||o(r,i))&&s.push(i);return s},t.prototype.match=function(t,e){var r=null;if("string"!=typeof t||e&&!this._isDataMatched(e))return null;for(var n=this._subRoutes,o=0,a=n.length;a>o;o++){var i=n[o],s=this._matchSubPattern(i,t);if(s){r=s;break}}return r},t.prototype._matchSubPattern=function(t,e){var r,n,a,u,p,f,l,c=null,h=this._options,d=h.postMatch,m=t.defaults||h.defaults;if(r=e.match(t.parseRegExp)){for(c={},n=1,a=r.length;a>n;++n)if("undefined"!=typeof r[n]&&""!==r[n])if(u=t.paramsMap[n-1],u===b)l=r[n];else if(u===_){if(e.charAt(e.length-2)===y)return null}else c[u]=r[n];if(l&&h.useQueryString!==!1){f=s.parse(l);for(u in f)if(o(f,u)&&!o(c,u))if(p=f[u],t.mainParamsMap[u]&&i(p)&&(p=p[0]),i(p))for(c[u]=[],n=0,a=p.length;a>n;++n)this._checkParamValue(t,u,p[n])&&c[u].push(p[n]);else this._checkParamValue(t,u,p)&&(c[u]=p)}for(u in m)o(m,u)&&!o(c,u)&&(c[u]=m[u])}return c&&"function"==typeof d&&(c=d(c,t),c&&"object"==typeof c||(c=null)),c},t.prototype.build=function(t,e){var r,n,o=this._subRoutes,a=o.length;if(t||(t={}),a>1)for(var i=0;a>i;i++){var s=i+1===a,u=o[i],p=u.requiredParams,f=this._getDefaults(u),l=this._buildSubPatternParams(u,t,e),c=this._getPatternParamsIntersection(p,l||{},f);if((c.length===p.length&&l||!e&&s)&&(e||l||!e&&s)){n=u,r=l;break}}else n=o[0],r=this._buildSubPatternParams(n,t,e);return r?this._buildSubPattern(n,r):null},t.prototype._buildSubPattern=function(t,e){return t._buildFn(e)},t.prototype._buildSubPatternParams=function(t,e,r){var n,a,i,u,p,f=this._options,l={},c=f.useQueryString!==!1,h={},d=f.preBuild,m=this._subRoutes.length,g=m>1,_=this._subRoutes.indexOf(t)===m-1;"function"==typeof d&&(e=d(e,t));for(a in e)if(o(e,a)&&null!==e[a]&&"undefined"!=typeof e[a]&&(t.mainParamsMap[a]||c)){if(i=e[a],(r||g&&!_)&&!this._checkParamValue(t,a,i))return null;(t.mainParamsMap[a]?l:h)[a]=i}if(r)for(u=0,p=t.requiredParams.length;p>u;++u)if(!o(l,t.requiredParams[u]))return null;return c&&(n=s.stringify(h),n&&(l[b]=n)),l},t.prototype.getData=function(){return this._options.data},t.prototype.getName=function(){return this._options.name},r.exports=t,r.exports},"./router":function(){function t(){return this instanceof t?(this._routes=[],this._routesByName={},void 0):new t}var r={},n=e("./route");return t.prototype.addRoute=function(t){var e,r;return e=new n(t),this._routes.push(e),r=e.getName(),r&&(this._routesByName[r]=e),e},t.prototype.find=function(){var t,e,r,n=[],o=this._routes;for(e=0,r=o.length;r>e;++e)t=o[e].match.apply(o[e],arguments),null!==t&&n.push([o[e],t]);return n},t.prototype.findFirst=function(){var t,e,r,n=this._routes;for(e=0,r=n.length;r>e;++e)if(t=n[e].match.apply(n[e],arguments),null!==t)return[n[e],t];return null},t.prototype.getRouteByName=function(t){return this._routesByName[t]||null},t.Route=n,r.exports=t,r.exports}}[t]()}var r=e("./router"),n=!0;"object"==typeof exports&&"string"!=typeof exports.nodeName&&(module.exports=r,n=!1),t.modules&&modules.define&&modules.require&&(modules.define("susanin",function(t){t(r)}),n=!1),"function"==typeof t.define&&define.amd&&(define(function(){return r}),n=!1),n&&(t.Susanin=r)}(this);